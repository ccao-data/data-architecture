sources:
  - name: iasworld
    loaded_at_field: date_parse(loaded_at, '%Y-%m-%d %H:%i:%S.%f')
    tags:
      - load_auto
      - test_qc_iasworld
      - type_res

    tables:
      - name: dweldat
        description: '{{ doc("table_dweldat") }}'
        freshness:
          filter: taxyr >= date_format(current_date - interval '1' year, '%Y')
          warn_after: {count: 24, period: hour}
          error_after: {count: 48, period: hour}

        columns:
          - name: ac
            description: Air condition
          - name: acarea
            description: Air conditioning area
          - name: accode
            description: Support AC code
          - name: acval
            description: Air conditioning value
          - name: addfact
            description: Additional factor
          - name: addnarea
            description: Living area in additions
          - name: addnrcnval
            description: The RCN from `ADDN`
          - name: addnval
            description: RCN value of additions
          - name: adjarea
            description: Adjusted area
          - name: adjfact
            description: '{{ doc("column_adjfact") }}'
          - name: adjgrmfact
            description: Neighborhood / class factor applied to `RESGRMVAL`
          - name: adjrate
            description: Adjusted base rate
          - name: adjrcnld
            description: Adjusted replacement cost new less depreciation
          - name: areafact
            description: Area factor
          - name: areasum
            description: '{{ doc("column_areasum") }}'
          - name: attic
            description: '{{ doc("shared_column_char_attic_type") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_attic_not_null
                  additional_select_columns: &select-columns
                    - taxyr
                    - parid
                    - card
                    - who
                    - wen
                  # Excludes non-regression classes, as defined in Assessor's
                  # online PDF of all class definitions
                  config: &unique-conditions
                    where: |
                      CAST(taxyr AS int) BETWEEN {{ var('test_qc_year_start') }} AND {{ var('test_qc_year_end') }}
                      AND cur = 'Y'
                      AND deactivat IS NULL
                      AND class NOT IN ('201', '213', '218', '219', '220', '221', '224', '225', '236', '240', '241', '290', '294', '297')
                  meta:
                    description: attic (attic type) should not be null
              - accepted_values:
                  name: iasworld_dweldat_attic_in_accepted_values
                  values: ['1', '2', '3', '4', '5']
                  config: *unique-conditions
                  meta:
                    description: >
                      attic (attic type) should be an integer between 1 and 5
          - name: atticarea
            description: Attic area
          - name: atticval
            description: Attic value
          - name: baserate
            description: Calculated base rate
          - name: basercn
            description: Base replacement cost new
          - name: basercnld
            description: '`RCNLD` for main section of the dwelling'
          - name: bgarval
            description: Basement garage value
          - name: bld_modelid
            description: '{{ doc("column_bld_modelid") }}'
          - name: bldguse
            description: Building use
          - name: bsmt
            description: '{{ doc("shared_column_char_bsmt") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_bsmt_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: bsmt (basement type) should not be null
              - accepted_values:
                  name: iasworld_dweldat_bsmt_in_accepted_values
                  values: ['1', '2', '3', '4', '5', '6', '7']
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      bsmt (basement type) should be an integer between 1 and 7
          - name: bsmtarea
            description: Unfinished basement area
          - name: bsmtcar
            description: Basement garage (number cars)
          - name: bsmtval
            description: Basement value
          - name: calceffyr
            description: Calculated effective year
          - name: calc_meth
            description: '{{ doc("shared_column_calc_meth") }}'
            tests:
              - accepted_values:
                  name: iasworld_dweldat_calc_meth_accepted_values
                  values: ["E"]
                  additional_select_columns: *select-columns
                  config:
                    where: |
                      CAST(taxyr AS int) BETWEEN {{ var('test_qc_year_start') }} AND {{ var('test_qc_year_end') }}
                      AND cur = 'Y'
                      AND deactivat IS NULL
                      AND class NOT IN ('201', '213', '218', '219', '220', '221', '224', '225', '236', '240', '241', '290', '294', '297')
                      AND calc_meth IS NOT NULL
                  meta:
                    description: calc_meth should be null or 'E'
          - name: card
            description: '{{ doc("column_card") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_card_not_null
                  config: *unique-conditions
              - dbt_utils.accepted_range:
                  name: iasworld_dweldat_card_gte_1
                  min_value: 1
                  config: *unique-conditions
          - name: catharea
            description: Cathedral ceiling area
          - name: cathval
            description: Cathedral ceiling RCN
          - name: cddesc
            description: Cost and Design description code
          - name: cdpct
            description: Cost and Design percent
          - name: cdu
            description: '{{ doc("shared_column_cdu") }}'
          - name: ceiling
            description: Ceilling
          - name: chgrsn
            description: '{{ doc("column_chgrsn") }}'
          - name: class
            description: '{{ doc("shared_column_class") }}'
            tests:
              - relationships:
                  name: iasworld_dweldat_class_in_ccao_class_dict
                  to: source('ccao', 'class_dict')
                  field: class_code
                  config:
                    where: |
                      CAST(taxyr AS int) BETWEEN {{ var('test_qc_year_start') }} AND {{ var('test_qc_year_end') }}
                      AND class NOT IN ('EX', 'RR')
                      AND cur = 'Y'
                      AND deactivat IS NULL
              - res_class_matches_pardat:
                  name: iasworld_dweldat_class_matches_pardat_class
                  additional_select_columns:
                    - taxyr
                    - parid
                    - who
                    - wen
                  config: *unique-conditions
                  meta:
                    description: at least one class should match pardat class
          - name: cline
            description: Condominium line
          - name: cndadjval
            description: Total living area
          - name: cndbaseval
            description: Main section ground floor area
          - name: cndcmplx
            description: Condominium complex
          - name: cnstfact
            description: Construction factor
          - name: cnstval
            description: Construction factor value
          - name: comwallfact
            description: Common wall factor
          - name: comwallpct
            description: Common wall percent
          - name: cond
            description: Condition code
          - name: condolvl
            description: Condominium floor level
          - name: condosflaovr
            description: Condo Sfla override at card level
          - name: condotyp
            description: Condominium type code
          - name: condovw
            description: Condominium View
          - name: convbldg
            description: '{{ doc("column_convbldg") }}'
          - name: cur
            description: '{{ doc("column_cur") }}'
            tests:
              - accepted_values:
                  name: iasworld_dweldat_cur_in_accepted_values
                  values: ['Y', 'D']
          - name: deactivat
            description: '{{ doc("column_deactivat") }}'
          - name: degrem
            description: Degree remodeled
          - name: depr
            description: Percent good from tables
          - name: deprt
            description: '{{ doc("column_deprt") }}'
          - name: ecndep
            description: '{{ doc("column_ecndep") }}'
          - name: ecnrsn
            description: '{{ doc("column_ecnrsn") }}'
          - name: eff_area
            description: Support total by card
          - name: effageovr
            description: '{{ doc("column_effageovr") }}'
          - name: effyr
            description: '{{ doc("column_effyr") }}'
          - name: effyrovr
            description: Override effective year
          - name: elepct
            description: Electric percentage
          - name: eleyr
            description: Electric year
          - name: estpct
            description: Estimated percentage
          - name: estyr
            description: Estimated year
          - name: excess
            description: '{{ doc("column_excess") }}'
          - name: exmppct
            description: '{{ doc("column_exmppct") }}'
          - name: exmppctover
            description: Override exemption percent
          - name: exmpval
            description: '{{ doc("column_exmpval") }}'
          - name: external_calc_rcnld
            description: '{{ doc("shared_column_external_calc_rcnld") }}'
            tests:
              - not_accepted_values:
                  name: iasworld_dweldat_external_calc_rcnld_not_0
                  values: [0]
                  quote: false
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      external_calc_rcnld (calculated full NMV) should not be 0
          - name: external_occpct
            description: '{{ doc("shared_column_external_occpct") }}'
            tests:
              - not_accepted_values:
                  name: iasworld_dweldat_external_occpct_not_0
                  values: [0]
                  quote: false
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      external_occpct (occupancy percentage) should not be 0
          - name: external_propct
            description: '{{ doc("shared_column_external_propct") }}'
            tests:
              - not_accepted_values:
                  name: iasworld_dweldat_external_propct_not_0
                  values: [0]
                  quote: false
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      external_propct (proration percentage) should not be 0
          - name: external_rcnld
            description: '{{ doc("shared_column_external_rcnld") }}'
            tests:
              - not_accepted_values:
                  name: iasworld_dweldat_external_rcnld_not_0
                  values: [0]
                  quote: false
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      external_rcnld (calculated full FMV) should not be 0
          - name: extwall
            description: '{{ doc("shared_column_char_ext_wall") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_extwall_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: extwall (exterior wall type) should not be null
              - accepted_values:
                  name: iasworld_dweldat_extwall_in_accepted_values
                  values: ['1', '2', '3', '4', '6', '7', '8', '9']
                  config: *unique-conditions
                  meta:
                    description: >
                      extwall (exterior wall type) should be 1, 2, 3, 4, 6, 7, 8, or 9
          - name: extwall1
            description: Exterior wall code
          - name: extwall1pct
            description: Exterior wall % (for `EXTWALL1`)
          - name: finbsmtarea
            description: Finished basement living area
          - name: finbsmtl
            description: Finished basement living area length
          - name: finbsmtval
            description: Finished basement value
          - name: finbsmtw
            description: Finished basement living area width
          - name: fixaddl
            description: Number additional plumbing fixtures
          - name: fixbath
            description: '{{ doc("shared_column_char_fbath") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_fixbath_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      fixbath (number of full bathrooms) should not be null
              - accepted_range:
                  name: iasworld_dweldat_fixbath_between_1_and_16
                  min_value: 1
                  max_value: 16
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      fixbath (number of full bathrooms) should be between 1 and 16
          - name: fixbath1
            description: Number of full bathrooms on the first floor
          - name: fixbath2
            description: Number of full bathrooms on the second floor
          - name: fixbath3
            description: Number of full bathrooms on the third floor
          - name: fixbath4
            description: Number of four fixture bathrooms
          - name: fixbath4m
            description: Number of four fixture bathrooms  in Main Floor
          - name: fixbath4u
            description: Number of four fixture bathrooms  in upper Floor
          - name: fixbath5
            description: Number of five fixture bathrooms
          - name: fixbath5m
            description: Number of five fixture bathrooms in Main Floor
          - name: fixbath5u
            description: Number of five fixture bathrooms in upper Floor
          - name: fixbath6
            description: Number of six fixture bathrooms
          - name: fixbath7
            description: Number of seven fixture bathrooms
          - name: fixbathb
            description: Number of full bathrooms in the basement
          - name: fixbathm
            description: Number full bathrooms  in Main Floor
          - name: fixbathu
            description: Number full bathrooms  in upper Floor
          - name: fixhalf
            description: '{{ doc("shared_column_char_hbath") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_fixhalf_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      fixhalf (number of half baths) should not be null
              - accepted_range:
                  name: iasworld_dweldat_fixhalf_between_0_and_6
                  min_value: 0
                  max_value: 6
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      fixhalf (number of half baths) should be between 0 and 6
          - name: fixhalf1
            description: Number of half baths on the first floor
          - name: fixhalf2
            description: Number of half baths on the second floor
          - name: fixhalf3
            description: Number of half baths on the third floor
          - name: fixhalfb
            description: Number of half baths in the basement
          - name: fixhalfm
            description: Number half bathrooms in Main Floor
          - name: fixhalfu
            description: Number half bathrooms in upper Floor
          - name: fixtot
            description: Total plumbing fixtures
          - name: fixtotovr
            description: Bathroom fixture override
          - name: floor
            description: Floor
          - name: floor1
            description: Floor 1
          - name: floor1pct
            description: Floor percent
          - name: floorfact
            description: Floor factor
          - name: flr1area
            description: Sub total value
          - name: flr1val
            description: First floor structure RCN
          - name: flrharea
            description: Half floor structure square foot
          - name: flrhval
            description: Half floor structure RCN
          - name: flruarea
            description: Upper floor structure square foot
          - name: flruval
            description: Upper floor structure RCN
          - name: fuel
            description: Heating fuel type
          - name: fundep
            description: '{{ doc("column_fundep") }}'
          - name: funrsn
            description: '{{ doc("column_funrsn") }}'
          - name: furpct
            description: Furnace percentage
          - name: furyr
            description: Furnace year
          - name: grade
            description: '{{ doc("shared_column_char_cnst_qlty") }}'
          - name: grdfact
            description: Grade factor
          - name: grmovr
            description: Override for the GRM Multiplier pulled from `LPNBHD`
          - name: grmrent
            description: Gross rent multiplier rent
          - name: grmunits
            description: Gross rent multiplier units
          - name: grpadj
            description: '{{ doc("column_grpadj") }}'
          - name: heat
            description: '{{ doc("shared_column_char_heat") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_heat_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      heat (interior heat type) should not be null
              - accepted_values:
                  name: iasworld_dweldat_heat_in_accepted_values
                  values: ['1', '2', '3', '4']
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      heat (interior heat type) should be an integer between 1 and 4
          - name: heatarea
            description: Heat area
          - name: heatsys
            description: Heating system type
          - name: heatval
            description: Heating/air value
          - name: hga
            description: '{{ doc("column_hga") }}'
          - name: iasw_id
            description: '{{ doc("column_iasw_id") }}'
          - name: intext
            description: Interior condition relative to exterior
          - name: intwall
            description: Inside wall
          - name: intwall1
            description: Inside wall 1
          - name: intwall1pct
            description: Inside wall percent
          - name: intwallfact
            description: Inside wall factor
          - name: jur
            description: '{{ doc("column_jur") }}'
          - name: kitpct
            description: Kitchen percentage
          - name: kityr
            description: Kitchen year
          - name: loaded_at
            description: '{{ doc("shared_column_loaded_at") }}'
          - name: locmult
            description: Local multiplier
          - name: lumpcamod
            description: '{{ doc("column_lumpcamod") }}'
          - name: lumpcure
            description: Lump cure value
          - name: mastrimarea
            description: Masonry trim square footage
          - name: mastriml
            description: Masonry trim, length
          - name: mastrimw
            description: Masonry trim, width
          - name: mgfa
            description: Main section ground floor area
          - name: mktadj
            description: '{{ doc("column_mktadj") }}'
          - name: mktrsn
            description: '{{ doc("column_chgrsn") }}'
            tests:
              - expression_is_true:
                  name: iasworld_dweldat_mktrsn_eq_5_mktadj_not_null
                  expression: |
                    != '5' OR mktadj IS NOT NULL
                  select_columns:
                    - taxyr
                    - parid
                    - card
                    - who
                    - wen
                    - mktadj
                  config:
                    where: |
                      CAST(taxyr AS int) BETWEEN {{ var('test_qc_year_start') }} AND {{ var('test_qc_year_end') }}
                      AND cur = 'Y'
                      AND deactivat IS NULL
                  meta:
                    category: incorrect_values
                    description: mktrsn should only be 5 if mktadj is not null
          - name: modover
            description: Residential override model
          - name: mvpattic
            description: MVP Attic
          - name: mvpbsmt
            description: MVP Basement
          - name: mvpsf
            description: MVP square footage
          - name: mvpstyle
            description: MVP style
          - name: mvpunfin
            description: MVP unfinished
          - name: nccalc
            description: '{{ doc("column_nccalc") }}'
          - name: ncoval
            description: '{{ doc("column_ncoval") }}'
          - name: nctot
            description: '{{ doc("column_nctot") }}'
          - name: ncval
            description: '{{ doc("column_ncval") }}'
          - name: newconmo
            description: '{{ doc("column_newconmo") }}'
          - name: newconpct
            description: '{{ doc("column_newconpct") }}'
          - name: numident
            description: Identical units
          - name: obsdep
            description: Observable Condition
          - name: obsrsn
            description: Reason code for observable condition
          - name: ovrmraval
            description: '{{ doc("column_ovrmraval") }}'
          - name: ovrnbhd
            description: '{{ doc("column_ovrnbhd") }}'
          - name: ovrrcn
            description: Override RCN value
          - name: ovrrcnld
            description: '{{ doc("column_ovrrcnld") }}'
          - name: parid
            description: '{{ doc("shared_column_pin") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_parid_not_null
              - relationships:
                  name: iasworld_dweldat_parid_in_pardat_parid
                  to: source('iasworld', 'pardat')
                  field: parid
                  config: *unique-conditions
          - name: pctcomplete
            description: Percent of construction completed
          - name: plumbgrade
            description: Plumbing grade
          - name: plumval
            description: Plumbing value
          - name: plupct
            description: Plumbing percentage
          - name: pluyr
            description: Plumbing year
          - name: prior_renolvl
            description: Prior renovation Level
          - name: prodamage
            description: '{{ doc("column_prodamage") }}'
          - name: prodate
            description: '{{ doc("column_prodate") }}'
          - name: profact
            description: '{{ doc("column_profact") }}'
          - name: protype
            description: '{{ doc("column_protype") }}'
          - name: rcnfact
            description: RCN adjustment factor
          - name: rcnld
            description: '{{ doc("column_rcnld") }}'
          - name: rcnval
            description: Replacement cost new of dwelling
          - name: recnr
            description: '{{ doc("column_recnr") }}'
          - name: recromarea
            description: Recreational room area
          - name: recroml
            description: Recreational room length
          - name: recromw
            description: Recreational room width
          - name: rectype
            description: '{{ doc("column_rectype") }}'
          - name: recval
            description: Recreational room value
          - name: rembath
            description: Bathrooms remodeled
          - name: remkit
            description: Kitchen remodeled
          - name: renolvl
            description: Renovation level
          - name: renoovr
            description: Override for renovation level
          - name: renopoint
            description: Sum of renovation points assigned to this parcel
          - name: renoyr
            description: Year of renovation
          - name: resfeatval
            description: The total residential feature value
          - name: resgrmval
            description: Gross rent multiplier value
          - name: resmod
            description: Residential cost model
          - name: rmbed
            description: '{{ doc("shared_column_char_beds") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_rmbed_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      rmbed (number of bedrooms) should not be null
              - accepted_range:
                  name: iasworld_dweldat_rmbed_sf_between_1_and_15
                  min_value: 1
                  max_value: 15
                  additional_select_columns: *select-columns
                  config:
                    where: |
                      CAST(taxyr AS int) BETWEEN {{ var('test_qc_year_start') }} AND {{ var('test_qc_year_end') }}
                      AND class NOT IN ('211', '212')
                      AND cur = 'Y'
                      AND deactivat IS NULL
                  meta:
                    description: >
                      rmbed (number of bedrooms) should be between 1 and 15
              - accepted_range:
                  name: iasworld_dweldat_rmbed_mf_between_1_and_24
                  min_value: 1
                  max_value: 24
                  additional_select_columns: *select-columns
                  config:
                    where: |
                      CAST(taxyr AS int) BETWEEN {{ var('test_qc_year_start') }} AND {{ var('test_qc_year_end') }}
                      AND class IN ('211', '212')
                      AND cur = 'Y'
                      AND deactivat IS NULL
                  meta:
                    description: >
                      rmbed (number of bedrooms) should be between 1 and 24
              - expression_is_true:
                  name: iasworld_dweldat_rmbed_lte_rmtot
                  expression: <= rmtot
                  select_columns:
                    - parid
                    - taxyr
                    - card
                    - who
                    - wen
                    - rmtot
                  config: *unique-conditions
                  meta:
                    category: relationships
                    description: >
                      rmbed (number of bedrooms) should be <= rmtot (number of rooms)
          - name: rmbed1
            description: Number of bedrooms on the first floor
          - name: rmbed2
            description: Number of bedrooms on the second floor
          - name: rmbed3
            description: Number of bedrooms on the third floor
          - name: rmbedb
            description: Number of bedrooms in the basement
          - name: rmdin
            description: Total number of dining rooms
          - name: rmdin1
            description: Number of dining rooms on the first floor
          - name: rmdin2
            description: Number of dining rooms on the second floor
          - name: rmdin3
            description: Number of dining rooms on the third floor
          - name: rmdinb
            description: Number of dining rooms in the basement
          - name: rmfam
            description: Number family rooms
          - name: rmfam1
            description: Number of family rooms on the first floor
          - name: rmfam2
            description: Number of family rooms on the second floor
          - name: rmfam3
            description: Number of family rooms on the third floor
          - name: rmfamb
            description: Number of family rooms in the basement
          - name: rmkit
            description: Total number of kitchens
          - name: rmkit1
            description: Number of kitchens on the first floor
          - name: rmkit2
            description: Number of kitchens on the second floor
          - name: rmkit3
            description: Number of kitchens on the third floor
          - name: rmkitb
            description: Number of kitchens in the basement
          - name: rmliv
            description: Total number of living rooms
          - name: rmliv1
            description: Number of living rooms on the first floor
          - name: rmliv2
            description: Number of living rooms on the second floor
          - name: rmliv3
            description: Number of living rooms on the third floor
          - name: rmlivb
            description: Number of living rooms in the basement
          - name: rmoth
            description: Total number of other rooms
          - name: rmoth1
            description: Number of other rooms on the first floor
          - name: rmoth2
            description: Number of other rooms on the second floor
          - name: rmoth3
            description: Number of other rooms on the third floor
          - name: rmothb
            description: Number of other rooms in the basement
          - name: rmtot
            description: '{{ doc("shared_column_char_rooms") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_rmtot_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: rmtot (number of rooms) should not be null
              - accepted_range:
                  name: iasworld_dweldat_rmtot_sf_between_1_and_40
                  min_value: 1
                  max_value: 40
                  additional_select_columns: *select-columns
                  config:
                    where: |
                      CAST(taxyr AS int) BETWEEN {{ var('test_qc_year_start') }} AND {{ var('test_qc_year_end') }}
                      AND class NOT IN ('211', '212')
                      AND cur = 'Y'
                      AND deactivat IS NULL
                  meta:
                    description: rmtot (number of rooms) should be between 1 and 40
              - accepted_range:
                  name: iasworld_dweldat_rmtot_sf_between_1_and_50
                  min_value: 1
                  max_value: 50
                  additional_select_columns: *select-columns
                  config:
                    where: |
                      CAST(taxyr AS int) BETWEEN {{ var('test_qc_year_start') }} AND {{ var('test_qc_year_end') }}
                      AND class IN ('211', '212')
                      AND cur = 'Y'
                      AND deactivat IS NULL
                  meta:
                    description: rmtot (number of rooms) should be between 1 and 50
          - name: salekey
            description: '{{ doc("column_salekey") }}'
          - name: seq
            description: '{{ doc("shared_column_seq") }}'
            tests:
              - dbt_utils.sequential_values:
                  name: iasworld_dweldat_seq_all_sequential_exist
                  group_by_columns:
                    - parid
                    - taxyr
                    - card
          - name: sfla
            description: '{{ doc("shared_column_char_bldg_sf") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_sfla_not_null
                  config: *unique-conditions
              - accepted_range:
                  name: iasworld_dweldat_sfla_sf_between_1_and_10000
                  min_value: 1
                  max_value: 10000
                  additional_select_columns: *select-columns
                  config:
                    where: |
                      CAST(taxyr AS int) BETWEEN {{ var('test_qc_year_start') }} AND {{ var('test_qc_year_end') }}
                      AND class NOT IN ('208', '209', '211', '212', '236', '297')
                      AND cur = 'Y'
                      AND deactivat IS NULL
                  meta:
                    description: >
                      sfla (bldg. square feet) should be between 1 and 10000
                      for single-family properties (excl. 208 or 209)
              - accepted_range:
                  name: iasworld_dweldat_sfla_mf_between_1_and_20000
                  min_value: 1
                  max_value: 20000
                  additional_select_columns: *select-columns
                  config:
                    where: |
                      CAST(taxyr AS int) BETWEEN {{ var('test_qc_year_start') }} AND {{ var('test_qc_year_end') }}
                      AND class IN ('208', '209', '211', '212')
                      AND cur = 'Y'
                      AND deactivat IS NULL
                  meta:
                    description: >
                      sfla (bldg. square feet) should be between 1 and 20000
                      for multi-family and large single-family
          - name: shfact
            description: Story height factor
          - name: sidpct
            description: Siding percentage
          - name: sidyr
            description: Siding year
          - name: sizecode
            description: Size code
          - name: slabarea
            description: Slab area
          - name: slabval
            description: Slab value
          - name: stage
            description: Recreation homes level
          - name: status
            description: '{{ doc("column_status") }}'
          - name: stories
            description: '{{ doc("shared_column_char_type_resd") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_stories_not_null
                  config: *unique-conditions
              - expression_is_true:
                  name: iasworld_dweldat_stories_in_accepted_values
                  expression: 'IN (1.00, 2.00, 3.00, 4.00, 5.00, 9.90)'
                  select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    category: incorrect_values
                    description: >
                      stories (type of residence) should be one of 1.00, 2.00,
                      3.00, 4.00, 5.00, or 9.90
          - name: style
            description: Architectural style
          - name: subtval
            description: Sub total value
          - name: suppress
            description: '{{ doc("column_suppress") }}'
          - name: taxyr
            description: '{{ doc("shared_column_year") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_taxyr_not_null
          - name: trans_id
            description: '{{ doc("column_trans_id") }}'
          - name: trimval
            description: Masonry trim value
          - name: ufeatarea
            description: Feature area
          - name: ufeatl
            description: Feature length
          - name: ufeatval
            description: Feature value
          - name: ufeatw
            description: Feature width
          - name: unfinarea
            description: Unfinished area
          - name: unfinl
            description: Unfinished area length
          - name: unfinval
            description: Unfinished area value
          - name: unfinw
            description: Unfinished area width
          - name: unitno
            description: '{{ doc("column_unitno") }}'
          - name: upd_status
            description: '{{ doc("column_upd_status") }}'
          - name: user1
            description: '{{ doc("shared_column_char_repair_cnd") }}'
          - name: user2
            description: '{{ doc("shared_column_char_site") }}'
          - name: user3
            description: '{{ doc("shared_column_char_renovation") }}'
            tests:
              - accepted_values:
                  name: iasworld_dweldat_char_renovation_in_accepted_values
                  values: ['0', '1']
                  config: *unique-conditions
          - name: user4
            description: '{{ doc("shared_column_char_tp_dsgn") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_char_tp_dsgn_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: user4 should not be null
              - accepted_values:
                  name: iasworld_dweldat_char_tp_dsgn_in_accepted_values
                  values: ['0', '1', '2', '3']
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: user4 should be an integer between 0 and 3
          - name: user5
            description: '{{ doc("shared_column_char_tp_plan") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_char_tp_plan_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: user5 (design plan) should not be null
              - accepted_values:
                  name: iasworld_dweldat_char_tp_plan_in_accepted_values
                  values: ['0', '1', '2']
                  config: *unique-conditions
          - name: user6
            description: '{{ doc("shared_column_char_attic_fnsh") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_char_attic_fnsh_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: user6 (attic finish) should not be null
              - accepted_values:
                  name: iasworld_dweldat_char_attic_fnsh_in_accepted_values
                  values: ['1', '2', '3']
                  config: *unique-conditions
          - name: user7
            description: '{{ doc("shared_column_char_air") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_char_air_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: user7 (central air indicator) should not be null
              - accepted_values:
                  name: iasworld_dweldat_char_air_accepted_values
                  values: ['1', '2']
                  config: *unique-conditions
          - name: user12
            description: '{{ doc("shared_column_char_bsmt_fin") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_char_bsmt_fin_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: user12 (basement finish) should not be null
              - accepted_values:
                  name: iasworld_dweldat_char_bsmt_fin_accepted_values
                  values: ['1', '2', '3', '4', '5', '6']
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      user12 (basement finish) should be an integer between 1 and 6
          - name: user13
            description: '{{ doc("shared_column_char_roof_cnst") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_char_roof_cnst_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: user13 (roof material) should not be null
              - accepted_values:
                  name: iasworld_dweldat_char_roof_cnst_accepted_values
                  values: ['1', '2', '3', '4', '5', '6']
                  config: *unique-conditions
          - name: user14
            description: '{{ doc("shared_column_char_apts") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_char_apts_not_null
                  additional_select_columns: *select-columns
                  config:
                    where: |
                      CAST(taxyr AS int) BETWEEN {{ var('test_qc_year_start') }} AND {{ var('test_qc_year_end') }}
                      AND class IN ('211', '212')
                      AND cur = 'Y'
                      AND deactivat IS NULL
                  meta:
                    description: >
                      user14 (number of apts. for class 211 and 212)
                      should not be null
              - accepted_values:
                  name: iasworld_dweldat_char_apts_accepted_values
                  values: ['1', '2', '3', '4', '5', '6']
                  additional_select_columns: *select-columns
                  config:
                    where: |
                      CAST(taxyr AS int) BETWEEN {{ var('test_qc_year_start') }} AND {{ var('test_qc_year_end') }}
                      AND class IN ('211', '212')
                      AND cur = 'Y'
                      AND deactivat IS NULL
                  meta:
                    description: >
                      user14 (number of apts. for class 211 and 212)
                      should be an integer between 1 and 6
          - name: user15
            description: '{{ doc("shared_column_char_use") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_char_use_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      user15 (single or multi-family use) should not be null
              - accepted_values:
                  name: iasworld_dweldat_char_use_accepted_values
                  values: ['1', '2']
                  config: *unique-conditions
          - name: user17
            description: Age. Deprecated, use `yrblt`
          - name: user20
            description: '{{ doc("shared_column_char_ncu") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_char_ncu_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      user20 (number of commercial units) should not be null
          - name: user24
            description: '{{ doc("shared_column_card_proration_rate") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_card_proration_rate_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: user24 (proration rate) should not be null
          - name: user30
            description: '{{ doc("shared_column_char_porch") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_char_porch_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: user30 (porch type) should not be null
              - accepted_values:
                  name: iasworld_dweldat_char_porch_accepted_values
                  values: ['0', '1', '2']
                  config: *unique-conditions
          - name: user31
            description: '{{ doc("shared_column_char_gar_att") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_char_gar_att_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      user31 (attached garage indicator) should not be null
              - accepted_values:
                  name: iasworld_dweldat_char_gar_att_accepted_values
                  values: ['1', '2']
                  config: *unique-conditions
          - name: user32
            description: '{{ doc("shared_column_char_gar_area") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_char_gar_area_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      user32 (garage area inclusion indicator) should not be null
              - accepted_values:
                  name: iasworld_dweldat_char_gar_area_accepted_values
                  values: ['1', '2']
                  config: *unique-conditions
          - name: user33
            description: '{{ doc("shared_column_char_gar_size") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_char_gar_size_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: user33 (garage size) should not be null
              - accepted_values:
                  name: iasworld_dweldat_char_gar_size_accepted_values
                  values: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10']
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      user33 (garage size) should be an integer between 1 and 10
          - name: user34
            description: '{{ doc("shared_column_char_gar_cnst") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_char_gar_cnst_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      user34 (garage ext. wall construction) should not be null
              - accepted_values:
                  name: iasworld_dweldat_char_gar_cnst_accepted_values
                  values: ['1', '2', '3', '4']
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      user34 (garage ext. wall construction) should be
                      an integer between 1 and 4
                  tags:
                    # Currently too many failures for this signal to be useful
                    - test_qc_exclude_from_workbook
          - name: useramt
            description: RCN value of additions
          - name: userfact
            description: Living area in additions
          - name: valmeth
            description: Valuation method (MAN/CLT)
          - name: wallhgt
            description: '{{ doc("column_wallhgt") }}'
          - name: wallhgtfact
            description: Wall height factor
          - name: wbfp_o
            description: '{{ doc("shared_column_char_frpl") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_char_frpl_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: wbfp_o (number of fireplaces) should not be null
              - accepted_range:
                  name: iasworld_dweldat_char_frpl_between_0_and_6
                  min_value: 0
                  max_value: 6
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: >
                      wbfp_o (number of fireplaces) should be between 0 and 6
          - name: wbfp_pf
            description: Wood burning fireplace - prefab
          - name: wbfp_pfx
            description: Additional stories for prefab fireplace stacks
          - name: wbfp_s
            description: Wood burning fireplace - number of stacks
          - name: wbfp_x
            description: Additional stories for wood-burning fireplace stacks
          - name: wbfpval
            description: Wood burning fireplace value
          - name: wen
            description: '{{ doc("shared_column_updated_at") }}'
          - name: wencalc
            description: '{{ doc("column_wencalc") }}'
          - name: who
            description: '{{ doc("shared_column_updated_by") }}'
          - name: whocalc
            description: '{{ doc("column_whocalc") }}'
          - name: winpct
            description: Windows percentage
          - name: winyr
            description: Windows year
          - name: yrblt
            description: '{{ doc("shared_column_char_yrblt") }}'
            tests:
              - not_null:
                  name: iasworld_dweldat_yrblt_not_null
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: yrblt should not be null
              - accepted_range:
                  name: iasworld_dweldat_yrblt_between_1850_and_now
                  min_value: 1850
                  max_value: cast(year(current_date) as decimal)
                  additional_select_columns: *select-columns
                  config: *unique-conditions
                  meta:
                    description: yrblt should be between 1850 and now
          - name: yrremod
            description: Year remodeled

        tests:
          - unique_combination_of_columns:
              name: iasworld_dweldat_unique_by_parid_card_taxyr
              combination_of_columns:
                - parid
                - taxyr
                - card
          - expression_is_true:
              name: iasworld_dweldat_card_proration_rate_between_0_and_100
              expression: 'CAST(user24 AS decimal) BETWEEN 0.00 AND 100.00'
              select_columns:
                - parid
                - taxyr
                - card
                - who
                - wen
                - user24
              config: *unique-conditions
              meta:
                category: incorrect_values
                description: user24 (proration rate) should be between 0 and 100
          - expression_is_true:
              name: iasworld_dweldat_char_ncu_between_0_and_5
              expression: 'CAST(user20 AS decimal) BETWEEN 0 AND 5'
              select_columns:
                - parid
                - taxyr
                - card
                - who
                - wen
                - user20
              config: *unique-conditions
              meta:
                category: missing_values
                description: user24 (proration rate) should not be null
          - expression_is_true:
              name: iasworld_dweldat_bsmt_and_user12_match_234_class
              expression: bsmt = '3' and user12 = '1'
              select_columns:
                - parid
                - taxyr
                - card
                - who
                - wen
                - class
                - bsmt
                - user12
              config:
                where: |
                  CAST(taxyr AS int) BETWEEN {{ var('test_qc_year_start') }} AND {{ var('test_qc_year_end') }}
                  AND cur = 'Y'
                  AND deactivat IS NULL
                  AND class = '234'
              meta:
                category: incorrect_values
                description: >
                  bsmt must be 3 (partial basement) and user12 must be 1
                  (finished basement) when class is 234 (split level)
