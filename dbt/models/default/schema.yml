version: 2


models:
  - name: default.vw_pin_history
    description: '{{ doc("vw_pin_history") }}'
    columns:
      - name: pin
        description: '{{ doc("shared_column_pin") }}'
      - name: year
        description: '{{ doc("shared_column_year") }}'
      - name: class
        description: '{{ doc("shared_column_class") }}'
      - name: township_code
        description: '{{ doc("shared_column_township_code") }}'
      - name: township_name
        description: '{{ doc("shared_column_township_name") }}'
      - name: twoyr_pri_mailed_tot
        description: Mailed total assessed value from 2 years prior to observation year
      - name: twoyr_pri_mailed_land
        description: Mailed assessed value of land from 2 years prior to observation year
      - name: twoyr_pri_mailed_bldg
        description: Mailed assessed value of building from 2 years prior to observation year
      - name: twoyr_pri_certified_tot
        description: Certified total assessed value from 2 years prior to observation year
      - name: twoyr_pri_certified_land
        description: Certified assessed value of land from 2 years prior to observation year
      - name: twoyr_pri_certified_bldg
        description: Certified assessed value of building from 2 years prior to observation year
      - name: twoyr_pri_board_tot
        description: Board of Review total assessed value from 2 years prior to observation year
      - name: twoyr_pri_board_land
        description: Board of Review assessed value of land from 2 years prior to observation year
      - name: twoyr_pri_board_bldg
        description: Board of Review assessed value of building from 2 years prior to observation year
      - name: oneyr_pri_mailed_tot
        description: Mailed total assessed value from 1 year prior to observation year
      - name: oneyr_pri_mailed_land
        description: Mailed assessed value of land from 1 year prior to observation year
      - name: oneyr_pri_mailed_bldg
        description: Mailed assessed value of building from 1 year prior to observation year
      - name: oneyr_pri_certified_tot
        description: Certified total assessed value from 1 year prior to observation year
      - name: oneyr_pri_certified_land
        description: Certified assessed value of land from 1 year prior to observation year
      - name: oneyr_pri_certified_bldg
        description: Certified assessed value of building from 1 year prior to observation year
      - name: oneyr_pri_board_tot
        description: Board of Review total assessed value from 1 year prior to observation year
      - name: oneyr_pri_board_land
        description: Board of Review assessed value of land from 1 year prior to observation year
      - name: oneyr_pri_board_bldg
        description: Board of Review assessed value of building from 1 year prior to observation year
      - name: mailed_tot
        description: Mailed total assessed value from observation year
      - name: mailed_land
        description: Mailed assessed value of land from observation year
      - name: mailed_bldg
        description: Mailed assessed value of building from observation year
      - name: certified_tot
        description: Certified total assessed value from observation year
      - name: certified_land
        description: Certified assessed value of land from observation year
      - name: certified_bldg
        description: Certified assessed value of building from observation year
      - name: board_tot
        description: Board of Review total assessed value from observation year
      - name: board_land
        description: Board of Review assessed value of land from observation year
      - name: board_bldg
        description: Board of Review assessed value of building from observation year
    tests:
      # Unique by 14-digit PIN and year
      - unique_combination_of_columns:
          name: vw_pin_history_unique_by_14_digit_pin_and_year
          combination_of_columns:
            - pin
            - year
  - name: default.vw_pin_value
    description: '{{ doc("vw_pin_value") }}'
    columns:
      - name: pin
        description: '{{ doc("shared_column_pin") }}'
      - name: year
        description: '{{ doc("shared_column_year") }}'
    tests:
      # Unique by 14-digit PIN and year
      - unique_combination_of_columns:
          name: vw_pin_value_unique_by_14_digit_pin_and_year
          combination_of_columns:
            - pin
            - year
      # TODO: Values match what's in whatever iasworld view feeds our website
  - name: default.vw_pin_appeal
    description: '{{ doc("vw_pin_appeal") }}'
    columns:
      - name: pin
        description: '{{ doc("shared_column_pin") }}'
      - name: class
        description: '{{ doc("shared_column_class") }}'
      - name: township_code
        description: '{{ doc("shared_column_township_code") }}'
      - name: year
        description: '{{ doc("shared_column_year") }}'
    tests:
      # `change` should be an enum
      - expression_is_true:
          name: vw_pin_appeal_no_unexpected_change_values
          expression: change is null or change in ('change', 'no change')
          select_columns:
            - pin
            - year
            - case_no
            - change
          config:
            error_if: ">43"
      # If there is a `change`, the values should reflect this
      - expression_is_true:
          name: vw_pin_appeal_change_matches_appeal_outcome
          expression: >-
            {% set vars = [
              ('mailed_bldg', 'certified_bldg'),
              ('mailed_land', 'certified_land'),
              ('mailed_tot', 'certified_tot'),
            ] %}

            (change = 'no change' AND
              -- Use ABS(...) <= 1 instead of equality for comparison to account
              -- for the fact that values are not always rounded consistently
              {% for mailed_var, certified_var in vars %}
                {% if loop.index0 > 0 %}AND{% endif %}
                (
                  ({{ mailed_var }} IS NULL AND {{ certified_var }} IS NULL)
                  OR
                  (ABS({{ mailed_var }} - {{ certified_var }}) <= 1)
                )
              {% endfor %}
            )
            OR
            (change = 'change' AND (
              {% for mailed_var, certified_var in vars %}
                {% if loop.index0 > 0 %}OR{% endif %}
                (
                  ({{ mailed_var }} IS NULL AND {{ certified_var }} IS NOT NULL)
                  OR
                  ({{ mailed_var }} IS NOT NULL AND {{ certified_var }} IS NULL)
                  OR
                  (ABS({{ mailed_var }} - {{ certified_var }}) > 1)
                )
              {% endfor %}
            ))
            OR
            (change is null)
          select_columns:
            - pin
            - year
            - case_no
            - mailed_bldg
            - certified_bldg
            - mailed_land
            - certified_land
            - mailed_tot
            - certified_tot
          config:
            error_if: ">266719"
  - name: default.vw_card_res_char
    description: '{{ doc("vw_card_res_char") }}'
    columns:
      - name: pin
        description: '{{ doc("shared_column_pin") }}'
      - name: pin10
        description: '{{ doc("shared_column_pin10") }}'
      - name: year
        description: '{{ doc("shared_column_year") }}'
      - name: card
        description: '{{ doc("shared_column_card") }}'
      - name: class
        description: '{{ doc("shared_column_class") }}'
      - name: township_code
        description: '{{ doc("shared_column_township_code") }}'
      - name: cdu
        description: '{{ doc("shared_column_cdu") }}'
      - name: card_proration_rate
        description: |
          Proration rate within a given PIN.

          Some PINs have multiple improvements, known as "cards". Total value for a PIN should be allocated across cards accordingly.
      - name: pin_is_multiland
        description: Indicates the PIN has more than one landline
      - name: pin_is_multicard
        description: Indicator for a PIN with more than one building (ADU, coach house, etc.)
      - name: char_tp_dsgn
        description: |
          Deprecated.

          Field has not been updated recently enough to be useful for modeling
      - name: char_site
        description: |
          Deprecated.

          This field lacks sufficient variation to be useful for modeling
      - name: char_rooms
        description: Number of total rooms in the building (excluding baths). Not to be confused with bedrooms
      - name: char_repair_cnd
        description: |
          Deprecated.

          This field is subjective and contains little variation. As such, it is not used for modeling
      - name: char_recent_renovation
        description: |
          Indicates whether or not a property was renovated within the last 3 years.

          Renovation is indicated by the char_renovation characteristic flipping from "NO" to "YES"
      - name: char_ncu
        description: |
          Number of commercial units.

          The vast majority are for properties with class 212
      - name: char_land_sf
        description: |
          Square footage of the land (not just the building) of the property.

          A single PIN can have multiple "land lines," meaning it can be associated with more than one 200-class land lot
      - name: char_hbath
        description: Number of half baths, defined as bathrooms without a shower or bathtub
      - name: char_gar1_area
        descripion: |
          Summary forthcoming.

          Is Garage 1 physically included within the building area? If yes, the garage area is subtracted from the building square feet calculation by the field agent
      - name: char_frpl
        description: Number of fireplaces, counted as the number of flues one can see from the outside of the building
      - name: char_fbath
        description: |
          Number of full bathrooms, defined as having a bath or shower.

          If this value is missing, the default value is set to 1
      - name: char_cnst_qlty
        descripion: |
          Summary forthcoming.

          In general, this field is not used consistently and is therefore not useful for analytical purposes
      - name: char_bldg_sf
        description: Square footage of the building, as measured from the exterior
      - name: char_beds
        description: Number of bedrooms in the building
      - name: char_apts
        description: |
          Number of apartments for class 211 and 212 properties.

          CAUTION: Note the numerically encoded values DO NOT correspond to the number of apartments i.e. code 1 means 2 apartments, code 6 means 0 apartments
      - name: char_age
        description: |
          Deprecated.

          Use year built instead
    tests:
      # Unique by card and year
      - dbt_utils.unique_combination_of_columns:
          name: vw_card_res_char_unique_by_pin_card_and_year
          combination_of_columns:
            - pin
            - year
            - card
      # TODO: Characteristics columns should adhere to pre-determined criteria
  - name: default.vw_pin_address
    description: '{{ doc("vw_pin_address") }}'
    columns:
      - name: pin
        description: '{{ doc("shared_column_pin") }}'
      - name: pin10
        description: '{{ doc("shared_column_pin10") }}'
      - name: year
        description: '{{ doc("shared_column_year") }}'
    tests:
      # Unique by 14-digit PIN and year
      - unique_combination_of_columns:
          name: vw_pin_address_unique_by_14_digit_pin_and_year
          combination_of_columns:
            - pin
            - year
      # No superfluous whitespace
      - no_extra_whitespace:
          name: vw_pin_address_no_extra_whitespace
          column_names:
            - prop_address_full
            - prop_address_city_name
            - prop_address_state
            - prop_address_zipcode_1
            - prop_address_zipcode_2
            - mail_address_full
            - mail_address_city_name
            - mail_address_state
            - mail_address_zipcode_1
            - mail_address_zipcode_2
          config:
            error_if: ">900000"
      # TODO: Mailing address changes after validated sale(?)
      # TODO: Site addresses are all in Cook County
  - name: default.vw_pin_condo_char
    description: '{{ doc("vw_pin_condo_char") }}'
    columns:
      - name: pin
        description: '{{ doc("shared_column_pin") }}'
      - name: pin10
        description: '{{ doc("shared_column_pin10") }}'
      - name: year
        description: '{{ doc("shared_column_year") }}'
      - name: card
        description: '{{ doc("shared_column_card") }}'
      - name: class
        description: '{{ doc("shared_column_class") }}'
      - name: township_code
        description: '{{ doc("shared_column_township_code") }}'
      - name: cdu
        description: '{{ doc("shared_column_cdu") }}'
      - name: parking_space_flag_reason
        description: Parking space/storage unit heuristic that was triggered
      - name: is_parking_space
        description: Deeded parking/garage space or storage unit detected either by valuations, CDU, or unit number/proration rate heuristics
      - name: is_common_area
        description: Building common area detected primarily through prior AV of less than 10
      - name: char_tiebldgpct
        description: |
          Proration rate for a given PIN.

          Some buildings sit across multiple PINs. This number is intended to capture the split in building value
      - name: char_building_pins
        description: The number of 14 digits PINs associated with a given 10 digit PIN in iasworld.pardat
      - name: char_building_non_units
        description: The number of 14 digits PINs associated with a given 10 digit PIN in iasworld.pardat less units identified as parking spaces, commone areas, or storage units through a number of validation criteria
      - name: card_proration_rate
        description: |
          Proration rate within a given PIN.

          Some PINs have multiple improvements, known as "cards". Total value for a PIN should be allocated across cards accordingly.
    tests:
      # Unique by 14-digit PIN and year
      - unique_combination_of_columns:
          name: vw_pin_condo_char_unique_by_14_digit_pin_and_year
          combination_of_columns:
            - pin
            - year
          config:
            error_if: ">70297"
      # TODO: Non-liveable unit heuristics
      # TODO: Row count matches PARDAT for condo classes
      # TODO: Non-unit and unit parcel count add up to total parcels per
      # 10-digit PIN
      # TODO: Sum of proration rate never exceeds 1 per 10-digit PIN
      # TODO: Characteristics columns should adhere to pre-determined criteria
  - name: default.vw_pin_land
    description: '{{ doc("vw_pin_land") }}'
    columns:
      - name: pin
        description: '{{ doc("shared_column_pin") }}'
      - name: year
        description: '{{ doc("shared_column_year") }}'
  - name: default.vw_pin_sale
    description: '{{ doc("vw_pin_sale") }}'
    columns:
      - name: pin
        description: '{{ doc("shared_column_pin") }}'
      - name: year
        description: '{{ doc("shared_column_year") }}'
      - name: township_code
        description: '{{ doc("shared_column_township_code") }}'
      - name: nbhd
        description: '{{ doc("shared_column_nbhd_code") }}'
      - name: class
        description: '{{ doc("shared_column_class") }}'
      - name: sale_price
        description: |
          Fair market sale price of a PIN.

          Sales are sourced from myDec/IDOR. This serves as the outcome variable in regression models
      - name: sale_key
        description: iasWorld internal sale identifier
      - name: sale_filter_upper_limit
        description: Calculated boundary used to filter sales. See view definition
      - name: sale_filter_lower_limit
        description: Calculated boundary used to filter sales. See view definition
      - name: sale_filter_count
        description: Number of sales used to calculate upper and lower boundary
      - name: num_parcels_sale
        description: Number of parcels that are part of multisale
      - name: is_multisale
        description: Indicates whether or not a sale involved multiple parcels
      - name: doc_no
        tests:
          - unique:
              config:
                error_if: ">1711769"
    tests:
      # No sales for same price/pin within 12 months
      - unique_combination_of_columns:
          name: vw_pin_sale_unique_price_pin_and_year
          combination_of_columns:
            - pin
            - year
            - sale_price
      # Number of sales for a given time period isn't suspicious
      - unique_combination_of_columns:
          name: vw_pin_sale_reasonable_number_of_sales_per_year
          combination_of_columns:
            - pin
            - year
          allowed_duplicates: 2
          config:
            error_if: ">3233"
      # TODO: Sale is validated (after sales validation has been added to
      # iasworld)
      # TODO: Validation is catching obvious outliers
      # TODO: Joins with other tables produce consistent number of rows
  - name: default.vw_pin_universe
    description: '{{ doc("vw_pin_universe") }}'
    columns:
      - name: class
        description: '{{ doc("shared_column_class") }}'
      - name: y_3435
        description: '{{ doc("shared_column_y_3435") }}'
      - name: x_3435
        description: '{{ doc("shared_column_x_3435") }}'
      - name: ward_num
        description: |
          Ward ID for municipalities with wards.

          currently only Chicago and Evanston
      - name: tieback_proration_rate
        description: |
          Proration rate for a given PIN.

          Some buildings sit across multiple PINs. This number is intended to capture the split in building value
      - name: tax_special_service_area_num
        description: |
          Tax ID of the special service area of a given PIN, if applicable.

          Taken from Cook County GIS shapefiles
      - name: school_unified_district_geoid
        description: |
          Unified school district ID for a given PIN.

          CPS is included as a unified district. Taken from Cook County GIS shapefiles
      - name: school_secondary_district_geoid
        description: |
          Secondary school district ID for a given PIN.

          For CPS, secondary school attendance boundaries are used. Taken from Cook County GIS shapefiles
      - name: school_elementary_district_geoid
        description: |
          Elementary school district ID for a given PIN.

          For CPS, elementary school attendance boundaries are used. Taken from Cook County GIS shapefiles
      - name: prop_address_zipcode_2
        description: |
          Property street address.

          Not the address of the taxpayer/property owner
      - name: prop_address_zipcode_1
        description: |
          Property street address.

          Not the address of the taxpayer/property owner
      - name: prop_address_unit_prefix
        description: |
          Property street address.

          Not the address of the taxpayer/property owner
      - name: prop_address_unit_number
        description: |
          Property street address.

          Not the address of the taxpayer/property owner
      - name: prop_address_suffix_2
        description: |
          Property street address.

          Not the address of the taxpayer/property owner
      - name: prop_address_suffix_1
        description: |
          Property street address.

          Not the address of the taxpayer/property owner
      - name: prop_address_street_number
        description: |
          Property street address.

          Not the address of the taxpayer/property owner
      - name: prop_address_street_name
        description: |
          Property street address.

          Not the address of the taxpayer/property owner
      - name: prop_address_street_dir
        description: |
          Property street address.

          Not the address of the taxpayer/property owner
      - name: prop_address_state
        description: |
          Property street address.

          Not the address of the taxpayer/property owner
      - name: prop_address_prefix
        description: |
          Property street address.

          Not the address of the taxpayer/property owner
      - name: prop_address_full
        description: |
          Property street address.

          Not the address of the taxpayer/property owner
      - name: prop_address_city_name
        description: |
          Property street address.

          Not the address of the taxpayer/property owner
      - name: pin
        description: '{{ doc("shared_column_pin") }}'
      - name: pin10
        description: '{{ doc("shared_column_pin10") }}'
      - name: year
        description: '{{ doc("shared_column_year") }}'
      - name: triad_name
        description: '{{ doc("shared_column_triad_name") }}'
      - name: triad_code
        description: '{{ doc("shared_column_triad_code") }}'
      - name: township_name
        description: '{{ doc("shared_column_township_name") }}'
      - name: township_code
        description: '{{ doc("shared_column_township_code") }}'
      - name: nbhd_code
        description: '{{ doc("shared_column_nbhd_code") }}'
      - name: tax_code
        description: '{{ doc("shared_column_tax_code") }}'
      - name: num_school_with_rating_in_half_mile
        description: Number of schools with Great Schools ratings within half mile of a given PIN
      - name: num_school_in_half_mile
        description: |
          Number of schools within half mile of a given PIN.

          This includes preschools, small private schools, universities, etc
      - name: num_pin_in_half_mile
        description: |
          Number of PINs within half mile of a given PIN.

          Condo buildings are counted as a single PIN
      - name: num_foreclosure_per_1000_pin_past_5_years
        description: |
          Number of PIN-level foreclosure in the past 5 years, per 1000 PINs, within half mile of a given PIN.

          Taken from Illinois Public Records https://public-record.com/login/
      - name: num_bus_stop_in_half_mile
        description: |
          Number of bus stops (CTA or PACE) within half mile of a given PIN.

          Taken from GTFS feeds retrieved from transitfeeds.com
      - name: nearest_water_dist_ft
        description: |
          Distance in feet to the nearest water.

          As identified by Cook County hydrology files
      - name: nearest_railroad_dist_ft
        description: |
          Distance in feet to the nearest rail (not including CTA).

          Taken from Cook County GIS shapefiles
      - name: nearest_park_dist_ft
        description: |
          Distance in feet to the nearest park.

          Pull via OpenStreetMap, key=leisure, value=park
      - name: nearest_metra_stop_dist_ft
        description: |
          Distance in feet to the nearest Metra stop.

          Taken from Metra GTFS feeds retrieved via transitfeeds.com
      - name: nearest_metra_route_dist_ft
        description: |
          Distance in feet to the nearest Metra tracks.

          Taken from Metra GTFS feeds retrieved via transitfeeds.com
      - name: nearest_major_road_dist_ft
        description: |
          Distance in feet to the nearest major road/highway.

          Pulled via OpenStreetMap, key=highway, value=motorway,primary,trunk
      - name: nearest_hospital_dist_ft
        description: |
          Distance in feet to the nearest hospital (polygon).

          Taken from Cook County GIS shapefiles
      - name: nearest_golf_course_dist_ft
        description: |
          Distance in feet to the nearest golf course (polygon).

          Taken from Cook County GIS shapefiles and OpenStreetMap
      - name: nearest_cta_stop_dist_ft
        description: |
          Distance in feet to the nearest CTA stop.

          Taken from CTA GTFS feeds retrieved via transitfeeds.com
      - name: nearest_cta_stop_data_year
        description: |
          Distance in feet to the nearest Metra stop.

          Taken from Metra GTFS feeds retrieved via transitfeeds.com
      - name: nearest_cta_route_dist_ft
        description: |
          Distance in feet to the nearest CTA tracks.

          Taken from CTA GTFS feeds retrieved via transitfeeds.com
      - name: nearest_cemetery_dist_ft
        description: |
          Distance in feet to the nearest cemetery (polygon).

          Taken from Cook County GIS shapefiles
      - name: nearest_bike_trail_dist_ft
        description: |
          Distance in feet to the nearest bike trail (linestring).

          Taken from Cook County GIS shapefiles
      - name: misc_unincorporated_area_bool
        description: |
          Indicator for a PIN within an unincorporated part of Cook County.

          Taken from Cook County GIS shapefiles
      - name: misc_subdivision_id
        description: |
          Subdivision ID for a given PIN.

          Nearly all PINs are within one subdivision. Each subdivision has a unique ID with the PageSubref column. Page being the area and section and subref being the letter of that sub on a page. The subrefs go A B C D and so on, however new subs can kill old subs, so a page could have subrefs B C G M L R S T, with each letter being a unique subdivision
      - name: mail_address_zipcode_2
        description: Taxpayer/property owner address
      - name: mail_address_zipcode_1
        description: Taxpayer/property owner address
      - name: mail_address_state
        description: Taxpayer/property owner address
      - name: mail_address_name
        description: Taxpayer/property owner address
      - name: mail_address_full
        description: Taxpayer/property owner address
      - name: mail_address_city_name
        description: Taxpayer/property owner address
      - name: lon
        description: '{{ doc("shared_column_longitude") }}'
      - name: lat
        description: '{{ doc("shared_column_latitude") }}'
      - name: lake_michigan_dist_ft
        description: |
          Distance in feet to the Lake Michigan coastline.

          Taken from TIGER/Line coastlines file and filtered to Cook County only
      - name: env_ohare_noise_contour_no_buffer_bool
        description: |
          O'Hare Airport 65 DNL noise contour.

          Taken from oharenoise.org
      - name: env_flood_fs_risk_direction
        description: |
          First Street risk direction for a given PIN.

          Positive scores indicate increasing future flood risk, negative scores the opposite. Provided to the CCAO by firststreet.org
      - name: env_flood_fs_factor
        description: |
          First Street flood factor (risk score) for a given PIN, scores 1 - 10.

          Provided to the CCAO by firststreet.org
      - name: env_flood_fema_sfha
        description: |
          Indicator for a PIN within a FEMA Special Flood Hazard Area.

          Taken from FEMA site for 2021 only
      - name: env_airport_noise_dnl
        description: |
          Airport noise calculated via kriging noise monitor data from CDA.

          See https://gitlab.com/ccao-data-science---modeling/models/ccao_res_avm/-/issues/70 for more information
      - name: cook_municipality_name
        description: |
          Municipality name for a given PIN.

          Taken from Cook County GIS shapefiles
      - name: census_acs5_tract_geoid
        description: |
          Summary forthcoming.

          Census ACS5 columns provide the geographic IDs (GEOIDs) of Census geography with the latest ACS5 data available. For example, only 2019 ACS5 data is available in 2022, so the ACS5 tract GEOID is the 2019 Census geography joined to the 2022 PIN
      - name: census_acs5_state_senate_geoid
        description: |
          Summary forthcoming.

          Census ACS5 columns provide the geographic IDs (GEOIDs) of Census geography with the latest ACS5 data available. For example, only 2019 ACS5 data is available in 2022, so the ACS5 tract GEOID is the 2019 Census geography joined to the 2022 PIN
      - name: census_acs5_state_representative_geoid
        description: |
          Summary forthcoming.

          Census ACS5 columns provide the geographic IDs (GEOIDs) of Census geography with the latest ACS5 data available. For example, only 2019 ACS5 data is available in 2022, so the ACS5 tract GEOID is the 2019 Census geography joined to the 2022 PIN
      - name: census_acs5_school_district_unified_geoid
        description: |
          Summary forthcoming.

          Census ACS5 columns provide the geographic IDs (GEOIDs) of Census geography with the latest ACS5 data available. For example, only 2019 ACS5 data is available in 2022, so the ACS5 tract GEOID is the 2019 Census geography joined to the 2022 PIN
      - name: census_acs5_school_district_secondary_geoid
        description: |
          Summary forthcoming.

          Census ACS5 columns provide the geographic IDs (GEOIDs) of Census geography with the latest ACS5 data available. For example, only 2019 ACS5 data is available in 2022, so the ACS5 tract GEOID is the 2019 Census geography joined to the 2022 PIN
      - name: census_acs5_school_district_elementary_geoid
        description: |
          Summary forthcoming.

          Census ACS5 columns provide the geographic IDs (GEOIDs) of Census geography with the latest ACS5 data available. For example, only 2019 ACS5 data is available in 2022, so the ACS5 tract GEOID is the 2019 Census geography joined to the 2022 PIN
      - name: census_acs5_puma_geoid
        description: |
          Summary forthcoming.

          Census ACS5 columns provide the geographic IDs (GEOIDs) of Census geography with the latest ACS5 data available. For example, only 2019 ACS5 data is available in 2022, so the ACS5 tract GEOID is the 2019 Census geography joined to the 2022 PIN
      - name: census_acs5_place_geoid
        description: |
          Summary forthcoming.

          Census ACS5 columns provide the geographic IDs (GEOIDs) of Census geography with the latest ACS5 data available. For example, only 2019 ACS5 data is available in 2022, so the ACS5 tract GEOID is the 2019 Census geography joined to the 2022 PIN
      - name: census_acs5_data_year
        description: |
          Summary forthcoming.

          Census ACS5 columns provide the geographic IDs (GEOIDs) of Census geography with the latest ACS5 data available. For example, only 2019 ACS5 data is available in 2022, so the ACS5 tract GEOID is the 2019 Census geography joined to the 2022 PIN
      - name: census_acs5_county_subdivision_geoid
        description: |
          Summary forthcoming.

          Census ACS5 columns provide the geographic IDs (GEOIDs) of Census geography with the latest ACS5 data available. For example, only 2019 ACS5 data is available in 2022, so the ACS5 tract GEOID is the 2019 Census geography joined to the 2022 PIN
      - name: census_acs5_congressional_district_geoid
        description: |
          Summary forthcoming.

          Census ACS5 columns provide the geographic IDs (GEOIDs) of Census geography with the latest ACS5 data available. For example, only 2019 ACS5 data is available in 2022, so the ACS5 tract GEOID is the 2019 Census geography joined to the 2022 PIN
      - name: avg_school_rating_in_half_mile
        description: |
          Average Great Schools rating for all schools (with a rating) within half mile of a given PIN.

          Public schools must be within the same district as the PIN to be considered in the average
      - name: access_cmap_walk_total_score
        description: |
          CMAP walkability score for a given PIN, including transit walkability.

          Taken from CMAP's ON TO 2050 walkability layer
      - name: access_cmap_walk_nta_score
        description: |
          CMAP walkability score for a given PIN, excluding transit walkability.

          Taken from CMAP's ON TO 2050 walkability layer
    tests:
      # Unique by 14-digit PIN and year
      - unique_combination_of_columns:
          name: vw_pin_universe_unique_by_14_digit_pin_and_year
          combination_of_columns:
            - pin
            - year
      # Number of towns is consistent over time
      - count_is_consistent:
          name: vw_pin_universe_township_code_count_is_consistent_by_year
          group_column: year
          count_column: township_code
      # Number of classes is consistent over time
      - count_is_consistent:
          name: vw_pin_universe_class_count_is_consistent_by_year
          group_column: year
          count_column: class
          config:
            error_if: ">24"
      # TODO: Data completeness correlates with availability of spatial data
      # by year
  - name: default.vw_pin_exempt

exposures:
  - name: parcel_universe
    label: Parcel Universe
    type: dashboard
    url: https://datacatalog.cookcountyil.gov/Property-Taxation/Assessor-Parcel-Universe/nj4t-kc8j
    depends_on:
      - ref('default.vw_pin_universe')
    owner:
      name: Data Department
    meta:
      test_row_count: true
    description: |
      A complete, historic universe of Cook County parcels with attached geographic, governmental, and spatial data.

      Notes: Contains a cornucopia of locational and spatial data for all parcels in Cook County.

      Use cases: Joining parcel-level data to this dataset allows analysis and reporting across a number of different political, tax, Census, and other boundaries.

  - name: single_and_multi_family_improvement_characteristics
    label: Single and Multi-Family Improvement Characteristics
    type: dashboard
    url: https://datacatalog.cookcountyil.gov/Property-Taxation/Assessor-Single-and-Multi-Family-Improvement-Chara/x54s-btds
    depends_on:
      - ref('default.vw_card_res_char')
    owner:
      name: Data Department
    meta:
      test_row_count: true
    description: |
      Single and multi-family (less than 7 units) property characteristics collected and maintained by the Assessor's Office for all of Cook County, from 1999 to present.

      Notes: Residential PINs with multiple improvements (living structures) will have one card for each improvement.

      Use cases: This data describes the location and physical characteristics of all single and multi-family improvements in the county. It can be:

        * Used on its own to characterize the housing stock in a specific location
        * Joined to assessments for analysis of assessments across geographies and housing types
        * Joined to sales for the construction of hedonic home value estimates

  - name: residential_condominium_unit_characteristics
    label: Residential Condominium Unit Characteristics
    type: dashboard
    url: https://datacatalog.cookcountyil.gov/Property-Taxation/Assessor-Residential-Condominium-Unit-Characteri/3r7i-mrz4
    depends_on:
      - ref('default.vw_pin_condo_char')
    owner:
      name: Data Department
    meta:
      test_row_count: true
    description: |
      Residential condominium unit characteristics collected and maintained by the Assessor's office for all of Cook County, from 1999 to present.

      Use cases: This data describes the location and physical characteristics of all condominium units in the county. Condominium units are associated with substantially less characteristic data than single and multi-family improvements. It can be:

        * Used on its own to characterize the housing stock in a specific location
        * Joined to assessments for analysis of assessments across geographies and housing types
        * Joined to sales for the construction of hedonic home value estimates

  - name: parcel_sales
    label: Parcel Sales
    type: dashboard
    url: https://datacatalog.cookcountyil.gov/Property-Taxation/Assessor-Parcel-Sales/wvhk-k5uv
    depends_on:
      - ref('default.vw_pin_sale')
    owner:
      name: Data Department
    meta:
      test_row_count: true
    description: |
      Parcel sales for real property in Cook County, from 1999 to present.

      Notes: Refreshed monthly, though data may only change roughly quarterly depending on how often new sales are added to iasWorld.

      Use cases: Alone, sales data can be used to characterize real estate markets. Sales paired with characteristics can be used to find comparable properties or as an input to an automated modeling application. Sales paired with assessments can be used to calculate sales ratio statistics. Outliers can be easily removed using filters constructed from class, township, and year variables.

  - name: assessed_values
    label: Assessed Values
    type: dashboard
    url: https://datacatalog.cookcountyil.gov/Property-Taxation/Assessor-Assessed-Values/uzyt-m557
    depends_on:
      - ref('default.vw_pin_history')
    owner:
      name: Data Department
    meta:
      test_row_count: true
    description: |
      Land, building, and total assessed values for all Cook County parcels, from 1999 to present.

      Notes: Refreshed monthly, data is updated as towns are mailed/certified by Valuations and the Board of Review.

      Use cases: Alone, can characterize assessments in a given area. Can be combined with characteristic data to make more nuanced generalizations about assessments. Can be combined with sales data to conduct ratio studies.

  - name: appeals
    label: Appeals
    type: dashboard
    url: https://datacatalog.cookcountyil.gov/Property-Taxation/Assessor-Appeals/y282-6ig3
    depends_on:
      - ref('default.vw_pin_appeal')
    owner:
      name: Data Department
    meta:
      test_row_count: true
    description: |
      Land, building, and total assessed values, pre and post-appeal with the Cook County Assessor’s office, for all Cook County parcels, from 1999 to present.

      Notes: Refreshed monthly, data is updated as towns are mailed/certified by Valuations.

      Use cases: Alone, can be used to investigate appeal trends. Can be combined with geographies to see how AV shifts around the county between mailing and assessor certified stages.

  - name: parcel_addresses
    label: Parcel Addresses
    type: dashboard
    url: https://datacatalog.cookcountyil.gov/Property-Taxation/Assessor-Parcel-Addresses/3723-97qp
    depends_on:
      - ref('default.vw_pin_address')
    owner:
      name: Data Department
    meta:
      test_row_count: true
    description: |
      Situs and mailing addresses of Cook County parcels.

      Notes: Refreshed monthly, data is updated as towns are mailed/certified by Valuations.

      Use cases: Can be used for geocoding or joining address-level data to other datasets.

  - name: property_tax_exempt_parcels
    label: Property Tax-Exempt Parcels
    type: dashboard
    url: https://datacatalog.cookcountyil.gov/Property-Taxation/Assessor-Property-Tax-Exempt-Parcels/vgzx-68gb
    depends_on:
      - ref('default.vw_pin_exempt')
    owner:
      name: Data Department
    meta:
      test_row_count: true
    description: |
      Parcels with property tax-exempt status across all of Cook County per tax year, from Tax Year 2022 on, with geographic coordinates and addresses.

      Notes: Refreshed monthly, data is updated when necessary as PINs are re-classified.

      Use cases: Can be used to study parcels that are exempted from paying property taxes.
