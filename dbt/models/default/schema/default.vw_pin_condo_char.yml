models:
  - name: default.vw_pin_condo_char
    description: '{{ doc("vw_pin_condo_char") }}'
    config:
      tags:
        - type_condo

    columns:
      - name: card
        description: '{{ doc("shared_column_card") }}'
      - name: card_proration_rate
        description: '{{ doc("shared_column_card_proration_rate") }}'
      - name: cdu
        description: '{{ doc("shared_column_cdu") }}'
      - name: char_beds
        description: '{{ doc("shared_column_char_beds") }}'
      - name: char_building_non_units
        description: |
          The number of 14-digit PINs associated with a given
          10-digit PIN in `iasworld.pardat`, minus units identified
          as parking spaces, commone areas, or storage units
          through a number of validation criteria
      - name: char_building_pins
        description: |
          The number of 14-digit PINs associated with a given
          10-digit PIN in `iasworld.pardat`
      - name: char_fbath
        description: '{{ doc("shared_column_char_fbath") }}'
      - name: char_hbath
        description: '{{ doc("shared_column_char_hbath") }}'
      - name: char_land_sf
        description: '{{ doc("shared_column_char_land_sf") }}'
      - name: char_yrblt
        description: '{{ doc("shared_column_char_yrblt") }}'
      - name: class
        description: '{{ doc("shared_column_class") }}'
      - name: is_common_area
        description: |
          Building common area.

          Detected primarily through prior AV of less than $10.
      - name: is_parking_space
        description: |
          Deeded parking/garage space or storage unit.

          Detected either by valuations, CDU, or unit
          number/proration rate heuristics.
      - name: lline
        description: '{{ doc("shared_column_lline") }}'
      - name: parking_space_flag_reason
        description: Parking space/storage unit heuristic used to flag this PIN
      - name: pin
        description: '{{ doc("shared_column_pin") }}'
      - name: pin10
        description: '{{ doc("shared_column_pin10") }}'
      - name: pin_is_multiline
        description: '{{ doc("shared_column_pin_is_multiline") }}'
      - name: pin_num_lline
        description: '{{ doc("shared_column_pin_num_lline") }}'
      - name: tieback_key_pin
        description: '{{ doc("shared_column_tieback_key_pin") }}'
      - name: tieback_proration_rate
        description: '{{ doc("shared_column_tieback_proration_rate") }}'
      - name: township_code
        description: '{{ doc("shared_column_township_code") }}'
      - name: unitno
        description: '{{ doc("shared_column_unitno") }}'
      - name: year
        description: '{{ doc("shared_column_year") }}'

    tests:
      - unique_combination_of_columns:
          name: vw_pin_condo_char_unique_by_14_digit_pin_and_year
          combination_of_columns:
            - pin
            - year
          config:
            error_if: ">70297"
      # TODO: Non-liveable unit heuristics
      # TODO: Row count matches PARDAT for condo classes
      # TODO: Non-unit and unit parcel count add up to total parcels per
      # 10-digit PIN
      # TODO: Sum of proration rate never exceeds 1 per 10-digit PIN
      # TODO: Characteristics columns should adhere to pre-determined criteria
