models:
  - name: default.vw_pin_value
    description: '{{ doc("view_vw_pin_value") }}'

    columns:
      - name: board_bldg
        description: '{{ doc("shared_column_board_bldg") }}'
      - name: board_bldg_mv
        description: '{{ doc("shared_column_board_bldg") }}'
      - name: board_class
        description: '{{ doc("shared_column_board_class") }}'
      - name: board_land
        description: '{{ doc("shared_column_board_land") }}'
      - name: board_land_mv
        description: '{{ doc("shared_column_board_land") }}'
      - name: board_tot
        description: '{{ doc("shared_column_board_tot") }}'
      - name: board_tot_mv
        description: '{{ doc("shared_column_board_land") }}'
      - name: certified_bldg
        description: '{{ doc("shared_column_certified_bldg") }}'
      - name: certified_bldg_mv
        description: '{{ doc("shared_column_certified_bldg") }}'
      - name: certified_class
        description: '{{ doc("shared_column_certified_class") }}'
      - name: certified_land
        description: '{{ doc("shared_column_certified_land") }}'
      - name: certified_land_mv
        description: '{{ doc("shared_column_certified_land") }}'
      - name: certified_tot
        description: '{{ doc("shared_column_certified_tot") }}'
      - name: certified_tot_mv
        description: '{{ doc("shared_column_certified_tot") }}'
      - name: change_reason
        description: '{{ doc("shared_column_change_reason") }}'
      - name: mailed_bldg
        description: '{{ doc("shared_column_mailed_bldg") }}'
      - name: mailed_bldg_mv
        description: '{{ doc("shared_column_mailed_bldg") }}'
      - name: mailed_class
        description: '{{ doc("shared_column_mailed_class") }}'
      - name: mailed_land
        description: '{{ doc("shared_column_mailed_land") }}'
      - name: mailed_land_mv
        description: '{{ doc("shared_column_mailed_land") }}'
      - name: mailed_tot
        description: '{{ doc("shared_column_mailed_tot") }}'
      - name: mailed_tot_mv
        description: '{{ doc("shared_column_mailed_tot") }}'
      - name: pin
        description: '{{ doc("shared_column_pin") }}'
      - name: stage_name
        description: |
          Name of currently active/open stages.

          One of `MAILED`, `ASSESSOR CERTIFIED`, or `BOARD CERTIFIED`
      - name: stage_num
        description: |
          Number of currently active/open stages.

          The possible values include:

          - `1` = Mailed
          - `2` = Certified
          - `3` = Board
      - name: year
        description: '{{ doc("shared_column_year") }}'

    data_tests:
    - unique_combination_of_columns:
        name: default_vw_pin_value_unique_by_14_digit_pin_and_year
        combination_of_columns:
          - pin
          - year

unit_tests:
  - name: default_vw_pin_value_mailed_class_strips_non_alphanumerics
    description: mailed_class transformation should remove non-alphanumeric characters
    model: default.vw_pin_value
    given:
      - input: source("iasworld", "asmt_all")
        # `class` is the important column here, and all other columns are only
        # provided to ensure proper joins when creating the dummy table
        rows:
          - {parid: "123", taxyr: "2024", procname: "CCAOVALUE", rolltype: "RP", valasm3: 10, class: "2.1-1)A"}
      - input: source("iasworld", "aprval")
        rows:
          - {parid: "123", taxyr: "2024", procname: "CCAOVALUE", reascd: "28"}
      - input: ref("ccao.aprval_reascd")
        rows:
          - {reascd: "28"}
    expect:
      rows:
        - {mailed_class: "211A"}
